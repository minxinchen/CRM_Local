# Google Sheets 整合測試指南

## 🎯 測試目標

驗證 `index_v3.html` 與 Google Sheets 的完整整合，確保所有 CRUD 操作和 Excel 備份功能正常運作。

---

## 📋 測試前準備

### 1. 確認 Google Sheet 結構

開啟您的 Google Sheet：
```
https://docs.google.com/spreadsheets/d/1t0bvTD2jnGApa0awRmIwsAXeQPmpTwI4pa-TfgkF4EY/edit
```

確認包含 `tasks` 工作表，欄位如下：

| ID | 標題 | 描述 | 狀態 | 到期日 | 案件ID | 建立日期 |
|----|------|------|------|--------|--------|----------|

如果沒有欄位標題，請手動新增（第一行）。

### 2. 開啟測試頁面

雙擊打開：
```
C:\Users\USER\Music\CRM\CRM_Local\index_v3.html
```

---

## ✅ 測試步驟

### 測試 1：初始載入 (READ)

**預期結果**:
- 頁面載入時顯示「同步中...」
- 載入完成後顯示現有任務（如果有）
- 統計卡片顯示正確數量
- 右上角顯示「上次同步」時間

**驗證方法**:
1. 打開瀏覽器開發者工具（F12）
2. 查看 Console 是否有錯誤訊息
3. 檢查 Network 標籤，確認 API 請求成功（狀態碼 200）

---

### 測試 2：新增任務 (CREATE)

**操作步驟**:
1. 點擊右上角「➕ 新增任務」
2. 填寫表單：
   - 標題：`測試任務 - Google Sheets 整合`
   - 描述：`這是第一個雲端同步的任務`
   - 狀態：選擇「本週必做」
   - 到期日：選擇明天的日期
   - 案件 ID：`1001`
3. 點擊「新增」按鈕

**預期結果**:
- 顯示「同步中...」
- 彈出提示：「✅ 任務已新增並同步到 Google Sheets」
- 任務列表立即顯示新任務
- 統計卡片數量更新

**驗證方法**:
1. 打開 Google Sheet
2. 查看 `tasks` 工作表
3. 確認新任務已出現（ID、標題、描述等）
4. 檢查「建立日期」欄位是否自動填入

---

### 測試 3：編輯任務 (UPDATE)

**操作步驟**:
1. 找到剛才新增的任務
2. 點擊「✏️ 編輯」
3. 修改內容：
   - 標題改為：`測試任務 - 已修改`
   - 狀態改為：「緊急待辦」
4. 點擊「更新」按鈕

**預期結果**:
- 顯示「同步中...」
- 彈出提示：「✅ 任務已更新並同步到 Google Sheets」
- 任務列表顯示更新後的內容
- 狀態標籤變為紅色（緊急待辦）

**驗證方法**:
1. 重新整理 Google Sheet
2. 確認任務內容已更新
3. 檢查修改的欄位是否正確

---

### 測試 4：刪除任務 (DELETE)

**操作步驟**:
1. 找到測試任務
2. 點擊「🗑️ 刪除」
3. 在確認對話框中點擊「確定」

**預期結果**:
- 顯示「同步中...」
- 彈出提示：「✅ 任務已刪除並同步到 Google Sheets」
- 任務從列表中消失
- 統計卡片數量更新

**驗證方法**:
1. 重新整理 Google Sheet
2. 確認任務已被刪除
3. 檢查任務總數是否減少

---

### 測試 5：Excel 備份功能

**操作步驟**:
1. 新增 2-3 個測試任務（確保有數據）
2. 點擊右上角「💾 下載 Excel 備份」按鈕
3. 等待同步完成

**預期結果**:
- 顯示「同步中...」
- 彈出提示：「✅ Excel 備份已建立！」
  - 顯示檔案名稱（例如：`tasks_backup_2024-12-03.xlsx`）
  - 顯示位置：`Google Drive > CRM_Backups`
- 自動開啟新分頁，顯示備份檔案連結

**驗證方法**:
1. 打開 Google Drive
2. 進入「CRM_Backups」資料夾
3. 確認備份檔案已建立
4. 下載檔案並用 Excel 開啟，檢查數據完整性

---

### 測試 6：快取功能

**操作步驟**:
1. 正常載入頁面（等待同步完成）
2. **在 5 分鐘內**重新整理頁面（F5）
3. 觀察載入速度

**預期結果**:
- 第一次載入：顯示「同步中...」（從 Google Sheets 讀取）
- 5 分鐘內重新整理：立即顯示任務（從快取讀取）
- Console 顯示：`Using cached data for tasks`

**驗證方法**:
1. 打開開發者工具 Console
2. 查看快取使用訊息
3. 檢查載入速度差異

---

### 測試 7：錯誤處理

**測試場景 A：網路中斷**
1. 關閉網路連線
2. 嘗試新增任務

**預期結果**:
- 頁面顯示紅色錯誤提示
- 提示訊息包含錯誤原因
- 不會當機或白畫面

**測試場景 B：必填欄位驗證**
1. 點擊「新增任務」
2. 不填寫標題，直接點擊「新增」

**預期結果**:
- 彈出提示：「請輸入任務標題」
- 不會發送 API 請求
- 表單仍保持開啟狀態

---

## 📊 測試檢查表

- [ ] ✅ 測試 1：初始載入成功
- [ ] ✅ 測試 2：新增任務成功
- [ ] ✅ 測試 3：編輯任務成功
- [ ] ✅ 測試 4：刪除任務成功
- [ ] ✅ 測試 5：Excel 備份成功
- [ ] ✅ 測試 6：快取功能正常
- [ ] ✅ 測試 7：錯誤處理正確

---

## 🐛 常見問題排查

### 問題 1：載入時顯示錯誤

**可能原因**:
- Apps Script 部署設定錯誤
- Google Sheet 沒有分享給 Service Account
- Web App URL 錯誤

**解決方法**:
1. 檢查 `index_v3.html` 的 `apiUrl` 是否正確
2. 確認 Google Sheet 已分享給 `c2-783@myday-youtube-n8n.iam.gserviceaccount.com`
3. 重新部署 Apps Script，確認設定：
   - 執行身分：**我**
   - 存取權：**任何人**

### 問題 2：CORS 錯誤

**錯誤訊息**:
```
Access to fetch at 'https://script.google.com/...' from origin 'null' has been blocked by CORS policy
```

**解決方法**:
- 這是正常現象（本地檔案開啟）
- Apps Script 會自動處理 CORS
- 如果仍有問題，請使用本地伺服器（例如：`python -m http.server`）

### 問題 3：備份失敗

**可能原因**:
- Apps Script 沒有 Google Drive 權限
- 備份資料夾不存在

**解決方法**:
1. 首次執行備份時，Apps Script 會要求授權
2. 點擊授權連結並允許存取 Google Drive
3. 重新嘗試備份

---

## 📝 測試報告範本

```
測試日期：2024-12-03
測試者：[您的名字]
瀏覽器：Chrome / Edge / Firefox
版本：[瀏覽器版本]

測試結果：
✅ 通過 / ❌ 失敗

測試 1 (READ)：✅ / ❌
測試 2 (CREATE)：✅ / ❌
測試 3 (UPDATE)：✅ / ❌
測試 4 (DELETE)：✅ / ❌
測試 5 (Excel 備份)：✅ / ❌
測試 6 (快取功能)：✅ / ❌
測試 7 (錯誤處理)：✅ / ❌

發現的問題：
[請描述遇到的任何問題]

改進建議：
[請提供改進建議]
```

---

## 🎓 下一步

所有測試通過後，您可以：

1. **部署到其他頁面**
   - 將 Google Sheets 整合應用到 `customers.html`、`cases.html`、`emails.html`

2. **UI 美化**（Priority 2）
   - 統計卡片升級（漸變背景、圖標動畫）
   - 表格現代化（可排序、篩選）
   - 浮動標籤表單

3. **進階功能**（Priority 3-8）
   - 深色模式
   - 多視圖系統（列表/卡片/看板）
   - 數據視覺化（Chart.js）
   - 拖放看板（SortableJS）

---

需要協助？請查看：
- 設定指南：`docs/GOOGLE_SHEETS_SETUP.md`
- 實施計劃：`docs/implementation-plan.md`
- 項目狀態：`C:\Users\USER\Documents\youtube影片分析\CRM_PROJECT_STATE.md`
